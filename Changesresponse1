@Override
public void writeRawSoapResponse(ValidateArrangementForPaymentRequest request, WebServiceMessage message) {
    try {
        InputStream xml = getClass().getClassLoader().getResourceAsStream("static-response/response1.xml");
        if (xml == null) throw new SchemaValidationException("response1.xml not found");

        JAXBContext jaxbContext = JAXBContext.newInstance(Envelope.class);
        Unmarshaller unmarshaller = jaxbContext.createUnmarshaller();
        Envelope envelope = (Envelope) unmarshaller.unmarshal(xml);

        ValidateArrangementForPaymentResponse response =
                envelope.getBody().getValidateArrangementForPaymentResponse();
        if (response != null && response.getResponse() != null && response.getResponse().getResponseHeader() != null) {
            var header = response.getResponse().getResponseHeader();
            if (header.getResponseId() != null) {
                header.getResponseId().setSystemId("ModifiedESP");
                header.getResponseId().setTransactionId("ModifiedTxn123");
            }
        }

        // Marshal to raw output first
        ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
        Marshaller marshaller = jaxbContext.createMarshaller();
        marshaller.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, Boolean.TRUE);
        marshaller.marshal(envelope, outputStream);

        // Write entire response directly as final SOAP message
        Transformer transformer = TransformerFactory.newInstance().newTransformer();
        transformer.transform(
            new StreamSource(new ByteArrayInputStream(outputStream.toByteArray())),
            message.getPayloadResult()
        );

    } catch (Exception e) {
        throw new SchemaValidationException("Failed to write raw JAXB-mapped SOAP response", e);
    }
}
